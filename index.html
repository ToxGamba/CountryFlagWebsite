<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Country Facts</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin: 20px;
    }
    .country-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
      padding: 20px;
    }
    .country {
      background: #1e1e1e;
      border: 1px solid #333;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
    }
    .country:hover {
      background: #333;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #222;
      padding: 20px;
      border-radius: 10px;
      width: 80%;
      max-width: 500px;
      text-align: left;
    }
    .close {
      float: right;
      cursor: pointer;
      font-size: 20px;
    }
    #adminPanel {
      display: none;
      background: #1b1b1b;
      padding: 20px;
      margin: 20px;
      border-radius: 10px;
      text-align: left;
    }
    .pending-item {
      background: #2a2a2a;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
    }
    .approve {
      background: green;
      color: white;
      border: none;
      padding: 5px 10px;
      margin-right: 5px;
      cursor: pointer;
      border-radius: 5px;
    }
    .reject {
      background: red;
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h1>ğŸŒ Country Facts</h1>

  <!-- Country Grid -->
  <div class="country-grid" id="countryGrid">
    <div class="country" onclick="openModal('Canada')">ğŸ‡¨ğŸ‡¦ Canada</div>
    <div class="country" onclick="openModal('USA')">ğŸ‡ºğŸ‡¸ USA</div>
    <div class="country" onclick="openModal('UK')">ğŸ‡¬ğŸ‡§ UK</div>
    <div class="country" onclick="openModal('Japan')">ğŸ‡¯ğŸ‡µ Japan</div>
    <div class="country" onclick="openModal('Germany')">ğŸ‡©ğŸ‡ª Germany</div>
    <div class="country" onclick="openModal('France')">ğŸ‡«ğŸ‡· France</div>
  </div>

  <!-- Submit Fact -->
  <h2>Submit a Fact</h2>
  <select id="countrySelect">
    <option value="">Select a country</option>
    <option value="Canada">Canada</option>
    <option value="USA">USA</option>
    <option value="UK">UK</option>
    <option value="Japan">Japan</option>
    <option value="Germany">Germany</option>
    <option value="France">France</option>
  </select>
  <input type="text" id="factInput" placeholder="Enter your fact here">
  <button onclick="submitFact()">Submit</button>

  <!-- Admin Panel -->
  <div id="adminPanel">
    <h2>Admin Panel - Pending Facts</h2>
    <div id="pendingList"></div>
  </div>

  <!-- Modal -->
  <div id="factModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2 id="modalCountry"></h2>
      <ul id="factList"></ul>
    </div>
  </div>

  <!-- Firebase + Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, set, get, remove, onValue }
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC8X4vku5TqaD_toaNNbBaX46yxHjCYSd8",
      authDomain: "countryflagwebsite.firebaseapp.com",
      databaseURL: "https://countryflagwebsite-default-rtdb.firebaseio.com",
      projectId: "countryflagwebsite",
      storageBucket: "countryflagwebsite.firebasestorage.app",
      messagingSenderId: "1019419410071",
      appId: "1:1019419410071:web:9362a50598211638caf3d2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Submit fact
    window.submitFact = function() {
      const country = document.getElementById("countrySelect").value;
      const fact = document.getElementById("factInput").value.trim();

      if (!country || !fact) {
        alert("Please select a country and enter a fact!");
        return;
      }

      const factRef = push(ref(db, "pendingFacts"));
      set(factRef, { country, fact });

      alert("Fact submitted! (Pending approval)");
      document.getElementById("factInput").value = "";
      document.getElementById("countrySelect").value = "";
    };

    // Load pending facts
    function loadPendingFacts() {
      const pendingRef = ref(db, "pendingFacts");
      onValue(pendingRef, (snapshot) => {
        const pendingList = document.getElementById("pendingList");
        pendingList.innerHTML = "";

        if (!snapshot.exists()) {
          pendingList.innerHTML = "<p>No pending facts.</p>";
          return;
        }

        snapshot.forEach((child) => {
          const item = child.val();
          const id = child.key;

          const div = document.createElement("div");
          div.className = "pending-item";
          div.innerHTML = `
            <strong>${item.country}</strong>: ${item.fact} <br>
            <button class="approve" onclick="approveFact('${id}', '${item.country}', \`${item.fact}\`)">Approve</button>
            <button class="reject" onclick="rejectFact('${id}')">Reject</button>
          `;
          pendingList.appendChild(div);
        });
      });
    }

    // Approve / Reject
    window.approveFact = function(id, country, fact) {
      const approvedRef = push(ref(db, "approvedFacts/" + country));
      set(approvedRef, fact);
      remove(ref(db, "pendingFacts/" + id));
    };

    window.rejectFact = function(id) {
      remove(ref(db, "pendingFacts/" + id));
    };

    // Show facts in modal
    window.openModal = function(country) {
      document.getElementById("modalCountry").innerText = country;
      const factList = document.getElementById("factList");
      factList.innerHTML = "";

      const approvedRef = ref(db, "approvedFacts/" + country);
      get(approvedRef).then((snapshot) => {
        if (!snapshot.exists()) {
          factList.innerHTML = "<li>No approved facts yet.</li>";
          return;
        }
        snapshot.forEach((child) => {
          const li = document.createElement("li");
          li.textContent = child.val();
          factList.appendChild(li);
        });
      });

      document.getElementById("factModal").style.display = "flex";
    };

    window.closeModal = function() {
      document.getElementById("factModal").style.display = "none";
    };

    // Show admin panel if ?admin=true
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get("admin") === "true") {
      document.getElementById("adminPanel").style.display = "block";
      loadPendingFacts();
    }
  </script>
</body>
</html>
